#!groovy

pipeline {
    agent any

    stages {
		stage('Stop wiki and db') {
			steps {
				echo "=== stop wiki and db ==="
				sh """
				sudo docker-compose -f ./ci/docker-compose.yml down
				"""
			}
		}

        stage('Stop containers') {
			steps {
				echo "=== stop containers ==="
				sh """
				sudo docker stop media_wiki |
				sudo docker stop mariadb |
				sudo docker stop adminer | 
				"""
			}
		}

		stage('Remove containers') {
			steps {
				echo "=== remove containers ==="
				sh """
				sudo docker rm media_wiki |
				sudo docker rm mariadb |
				sudo docker rm adminer |
				"""
			}
		}

		stage('Remove images') {
			steps {
				echo "=== remove image ==="
				sh """
				sudo docker rmi mediawiki |
				sudo docker rmi mariadb |
				sudo docker rmi adminer |
				"""
			}
		}
	}
}